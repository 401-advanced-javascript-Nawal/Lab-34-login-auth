(this["webpackJsonpLab-34-login-auth"]=this["webpackJsonpLab-34-login-auth"]||[]).push([[0],{110:function(t,e){},112:function(t,e){},149:function(t,e){},150:function(t,e){},206:function(t,e,n){"use strict";n.r(e);var a=n(9),o=n(10),c=n(12),i=n(11),r=n(13),u=n(2),l=n.n(u),s=n(97),h=n.n(s),d=n(52),b=n.n(d),p=n(51),m=n.n(p),O=Object({NODE_ENV:"production",PUBLIC_URL:"/Lab-34-login-auth",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_API,g=l.a.createContext(),f=function(t){function e(t){var n;return Object(a.a)(this,e),(n=Object(c.a)(this,Object(i.a)(e).call(this,t))).login=function(t,e){fetch("".concat(O,"/signin"),{method:"post",mode:"cors",cache:"no-cache",headers:new Headers({Authorization:"Basic ".concat(btoa("".concat(t,":").concat(e)))})}).then((function(t){return t.text()})).then((function(t){return n.validateToken(t)})).catch(console.error)},n.validateToken=function(t){try{var e=m.a.verify(t,Object({NODE_ENV:"production",PUBLIC_URL:"/Lab-34-login-auth",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_SECRET);n.setLoginState(!0,t,e)}catch(a){n.setLoginState(!1,null,{}),console.error("token invalid")}},n.setLoginState=function(t,e,a){b.a.save("auth",e),n.setState({token:e,loggedIn:t,user:a})},n.logout=function(){n.setLoginState(!1,null,{})},n.state={loggedIn:!1,login:n.login,logout:n.logout,user:{}},n}return Object(r.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){var t=new URLSearchParams(window.location.search),e=b.a.load("auth"),n=t.get("token")||e||null;this.validateToken(n)}},{key:"render",value:function(){return l.a.createElement(g.Provider,{value:this.state},this.props.children)}}]),e}(l.a.Component),E=n(98),v=function(t){return t.condition?t.children:null},j=function(t){function e(t){var n;return Object(a.a)(this,e),(n=Object(c.a)(this,Object(i.a)(e).call(this,t))).handleChange=function(t){n.setState(Object(E.a)({},t.target.name,t.target.value))},n.handleSubmit=function(t){t.preventDefault(),n.context.login(n.state.username,n.state.password),t.target.reset()},n.state={username:"",password:""},n}return Object(r.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(v,{condition:this.context.loggedIn},l.a.createElement("button",{onClick:this.context.logout},"Log Out!")),l.a.createElement(v,{condition:!this.context.loggedIn},l.a.createElement("form",{onSubmit:this.handleSubmit},l.a.createElement("input",{name:"username",onChange:this.handleChange}),l.a.createElement("input",{name:"password",onChange:this.handleChange}),l.a.createElement("button",null,"Log In!"))))}}]),e}(l.a.Component);j.contextType=g;var S=j,C=function(t){return t.condition?t.children:null},T=function(t){function e(){return Object(a.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){var t=!1;try{t=this.context.loggedIn&&(!this.props.capability||this.context.user.capabilities.includes(this.props.capability))}catch(e){console.warn("not authorized to do that")}return l.a.createElement(C,{condition:t},l.a.createElement("div",null,this.props.children))}}]),e}(l.a.Component);T.contextType=g;var _=T,y=function(t){return l.a.createElement(_,{capability:"update"},l.a.createElement("span",null,"You can edit!"))},k=function(t){return l.a.createElement(_,{capability:"delete"},l.a.createElement("span",null,"You can delete!"))},L=function(t){function e(){return Object(a.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return l.a.createElement(f,null,l.a.createElement(S,null),l.a.createElement(y,null),l.a.createElement(k,null))}}]),e}(l.a.Component),P=function(t){function e(){return Object(a.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return l.a.createElement(L,null)}}]),e}(l.a.Component),x=document.getElementById("root");h.a.render(l.a.createElement(P,null),x)},99:function(t,e,n){t.exports=n(206)}},[[99,1,2]]]);
//# sourceMappingURL=main.9b8476d4.chunk.js.map