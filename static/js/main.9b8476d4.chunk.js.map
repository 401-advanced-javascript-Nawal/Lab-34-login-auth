{"version":3,"sources":["components/context.js","components/login.js","components/auth.js","app.js","index.js"],"names":["API","process","REACT_APP_API","LoginContext","React","createContext","LoginProvider","props","login","username","password","fetch","method","mode","cache","headers","Headers","btoa","then","response","text","token","validateToken","catch","console","error","user","jwt","verify","REACT_APP_SECRET","setLoginState","loggedIn","cookie","save","setState","logout","state","qs","URLSearchParams","window","location","search","cookieToken","load","get","this","Provider","value","children","Component","If","condition","Login","handleChange","e","target","name","handleSubmit","preventDefault","context","reset","onClick","onSubmit","onChange","contextType","Auth","okToRender","capability","capabilities","includes","warn","Edit","Delete","App","Main","root","document","getElementById","ReactDOM","render"],"mappings":"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","file":"static/js/main.9b8476d4.chunk.js","sourcesContent":["import React from 'react';\nimport cookie from 'react-cookies';\nimport jwt from 'jsonwebtoken';\n\nconst API = process.env.REACT_APP_API;\n\nexport const LoginContext = React.createContext();\n\nclass LoginProvider extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loggedIn: false,\n      login: this.login,\n      logout: this.logout,\n      user: {},\n    };\n  }\n\n  login = (username, password) => {\n    fetch(`${API}/signin`, {\n      method: 'post',\n      mode: 'cors',\n      cache: 'no-cache',\n      headers: new Headers({\n        'Authorization': `Basic ${btoa(`${username}:${password}`)}`,\n      }),\n    })\n      .then(response => response.text())\n      .then(token => this.validateToken(token))\n      .catch(console.error);\n  }\n\n  validateToken = token => {\n    try {\n      let user = jwt.verify(token, process.env.REACT_APP_SECRET);\n      this.setLoginState(true, token, user);\n    } catch {\n      this.setLoginState(false, null, {});\n      console.error('token invalid');\n    }\n  }\n\n  setLoginState = (loggedIn, token, user) => {\n    cookie.save('auth', token);\n    this.setState({ token, loggedIn, user });\n  }\n\n  logout = () => {\n    this.setLoginState(false, null, {});\n  }\n\n  componentDidMount() {\n    const qs = new URLSearchParams(window.location.search);\n    const cookieToken = cookie.load('auth');\n    const token = qs.get('token') || cookieToken || null;\n    this.validateToken(token);\n  }\n\n  render() {\n    return (\n      <LoginContext.Provider value={this.state}>\n        {this.props.children}\n      </LoginContext.Provider>\n    );\n  }\n}\n\nexport default LoginProvider;","import React from 'react';\nimport { LoginContext } from './context.js';\nimport { JsonWebTokenError } from 'jsonwebtoken';\n\nconst If = props => {\n  return props.condition ? props.children : null;\n};\n\nclass Login extends React.Component {\n  static contextType = LoginContext;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      username: '',\n      password: '',\n    };\n  }\n\n  handleChange = e => {\n    this.setState({ [e.target.name] : e.target.value });\n  }\n\n  handleSubmit = e => {\n    e.preventDefault();\n    this.context.login(this.state.username, this.state.password);\n    e.target.reset();\n  }\n\n  render() {\n    return (\n      <>\n        <If condition={this.context.loggedIn}>\n          <button onClick={this.context.logout}>Log Out!</button>\n        </If>\n\n        <If condition={!this.context.loggedIn}>\n          <form onSubmit={this.handleSubmit}>\n            <input name=\"username\" onChange={this.handleChange} />\n            <input name=\"password\" onChange={this.handleChange} />\n            <button>Log In!</button>\n          </form>\n        </If>\n      </>\n    );\n  }\n}\n\nexport default Login;","import React from 'react';\nimport { LoginContext } from './context.js';\n\nconst If = props => {\n  return props.condition ? props.children : null;\n};\n\nclass Auth extends React.Component{\n  static contextType = LoginContext;\n\n  render() {\n    let okToRender = false;\n\n    try {\n      okToRender =\n        this.context.loggedIn &&\n          (this.props.capability\n            ? this.context.user.capabilities.includes(this.props.capability)\n            : true);\n    } catch {\n      console.warn('not authorized to do that');\n    }\n    return (\n      <If condition={okToRender}>\n        <div>{this.props.children}</div>\n      </If>\n    );  \n  }\n}\n\nexport default Auth;","import React from 'react';\nimport LoginContext from './components/context.js';\nimport Login from './components/login.js';\nimport Auth from './components/auth.js';\n\nconst Edit = props => {\n  return (\n    <Auth capability=\"update\">\n      <span>You can edit!</span>\n    </Auth>\n  );\n};\n\nconst Delete = props => {\n  return (\n    <Auth capability=\"delete\">\n      <span>You can delete!</span>\n    </Auth>\n  );\n};\n\nclass App extends React.Component {\n  render() {\n    return (\n      <LoginContext>\n        <Login />\n        <Edit />\n        <Delete />\n      </LoginContext>\n    );\n  }\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app.js';\n\nclass Main extends React.Component {\n  render() {\n    return (\n      <App />\n    );\n  }\n}\n\nconst root = document.getElementById('root');\nReactDOM.render(<Main />, root);"],"sourceRoot":""}